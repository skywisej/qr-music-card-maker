<!DOCTYPE html><html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Login â€¢ QR Music Deck</title></head>
<body style="height:100vh;display:flex;align-items:center;justify-content:center;background:black;color:white;font:16px Helvetica;">
<div style="display:flex;flex-direction:column;gap:12px;align-items:center;">
  <button id="login" style="font-size:1.4rem;padding:1rem 2rem;border-radius:14px;background:#1db954;color:white;border:none;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.4);">
    Log in with Spotify
  </button>
  <label style="opacity:.85;"><input id="force" type="checkbox" checked> Force account chooser</label>
</div>
<script>
const CLIENT_ID = "f373adfc90734648bd432988e370ab64";
const REDIRECT_URI  = "https://skywisej.github.io/qr-music-card-maker/login-callback.html";
const SCOPES = [
  "streaming",
  "user-read-email",
  "user-read-private",
  "user-modify-playback-state",
  "user-read-playback-state"
].join(" ");
function base64url(buf){
  return btoa(String.fromCharCode(...new Uint8Array(buf))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");
}
document.getElementById("login").onclick = async () => {
  const rand      = crypto.getRandomValues(new Uint8Array(64));
  const verifier  = base64url(rand);
  const hash      = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(verifier));
  const challenge = base64url(hash);
  const state     = Math.random().toString(36).slice(2);
  localStorage.setItem("hitster_verifier", verifier);
  localStorage.setItem("hitster_state", state);

  const url = new URL("https://accounts.spotify.com/authorize");
  url.searchParams.set("client_id", CLIENT_ID);
  url.searchParams.set("response_type", "code");
  url.searchParams.set("redirect_uri", REDIRECT_URI);
  url.searchParams.set("code_challenge_method", "S256");
  url.searchParams.set("code_challenge", challenge);
  url.searchParams.set("scope", SCOPES);
  url.searchParams.set("state", state);
  if (document.getElementById("force").checked) url.searchParams.set("show_dialog","true");
  location.href = url.toString();
};
</script>
</body></html>